
<!DOCTYPE html>
<html lang="" class="loading">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>假期集训逆向 - Theorist</title>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate" />
    <meta name="keywords" content="Theorist,"> 
    <meta name="description" content="Theorist&#39;s Blog,假期留校集训，关在实验室自生自灭，做了几道简单的逆向题，各大平台的都有。
实验吧whatamitoyou给了提示“你会唱歌吗？”，ELF文件，先用IDA静态分析，main函数开始先进行了很长很长的声,"> 
    <meta name="author" content="Theorist"> 
    <link rel="alternative" href="atom.xml" title="Theorist" type="application/atom+xml"> 
    <link rel="icon" href="https://s2.ax1x.com/2019/07/10/Z6aCSs.png"> 
    
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">

    
<link rel="stylesheet" href="/css/diaspora.css">

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
         (adsbygoogle = window.adsbygoogle || []).push({
              google_ad_client: "ca-pub-8691406134231910",
              enable_page_level_ads: true
         });
    </script>
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
<meta name="generator" content="Hexo 5.4.0"></head>

<body class="loading">
    <span id="config-title" style="display:none">Theorist</span>
    <div id="loader"></div>
    <div id="single">
    <div id="top" style="display: block;">
    <div class="bar" style="width: 0;"></div>
    <a class="iconfont icon-home image-icon" href="javascript:;" data-url="https://theorist.fun"></a>
    <div title="播放/暂停" class="iconfont icon-play"></div>
    <h3 class="subtitle">假期集训逆向</h3>
    <div class="social">
        <div>
            <div class="share">
                <a title="获取二维码" class="iconfont icon-scan" href="javascript:;"></a>
            </div>
            <div id="qr"></div>
        </div>
    </div>
    <div class="scrollbar"></div>
</div>

    <div class="section">
        <div class="article">
    <div class='main'>
        <h1 class="title">假期集训逆向</h1>
        <div class="stuff">
            <span>七月 19, 2019</span>
            
  <ul class="post-tags-list" itemprop="keywords"><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/writeup/" rel="tag">writeup</a></li><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/%E6%B1%87%E7%BC%96/" rel="tag">汇编</a></li></ul>


        </div>
        <div class="content markdown">
            <p>假期留校集训，关在实验室自生自灭，做了几道简单的逆向题，各大平台的都有。</p>
<h1 id="实验吧"><a href="#实验吧" class="headerlink" title="实验吧"></a>实验吧</h1><h2 id="whatamitoyou"><a href="#whatamitoyou" class="headerlink" title="whatamitoyou"></a>whatamitoyou</h2><p>给了提示“你会唱歌吗？”，ELF文件，先用IDA静态分析，main函数开始先进行了很长很长的声明很多变量，变量赋值，再把变量的地址赋值给另个变量，赋值的部分把int值按R转化成字符串会发现是倒序的一些英文句子，倒序是因为数字转化成字符串存在内存中的小端存储问题，在x86结构的内存中数字是高位存在低地址，把转化成字符串就会调转顺序：</p>
<p><img src="https://s2.ax1x.com/2019/07/19/Zjj5W9.png"></p>
<p>根据提示猜测这些句子可能是歌词，于是Google搜到了这首歌：</p>
<p><img src="https://s2.ax1x.com/2019/07/19/ZjvjBV.png"></p>
<p>发现题中的歌词是乱序的，猜测解题和顺序有关。<br>“准备工作”结束后进行了一系列看不大懂的运算：</p>
<p><img src="https://s2.ax1x.com/2019/07/19/Zv9jFf.png"></p>
<p>Linux下edb动态调试，开始的声明，赋值直接跳过后在漫长的“准备工作”最后，结合ida可以发现把第一句歌词的地址赋给了[rbp-8]:</p>
<p><img src="https://s2.ax1x.com/2019/07/19/Zv95WD.png"></p>
<p>这里开始操作输入的字符串,把字符放入[rbp-0x11]：</p>
<p><img src="https://s2.ax1x.com/2019/07/19/ZvF17n.png"> </p>
<p>跟进跳转到这里用字符对歌词地址进行操作<code>“旧地址+(字符-0x41+0x20)*8=新地址”</code>：</p>
<p><img src="https://s2.ax1x.com/2019/07/19/ZvVOGq.png"></p>
<p>结合IDA找到第二句歌词<code>&quot;I should have just told you&quot;</code>的地址，有两个，都进行逆运算得出输入的第一个字符应该是<code>67=&#39;C&#39;</code>：</p>
<p><img src="https://s2.ax1x.com/2019/07/19/ZvQKj1.png"></p>
<p>一直重复就能找出全部字符串，其实也有规律，在栈里存每一段歌词的地址下面不远处有连续四个地方存的是其他歌词的地址，字符ABCD运算下来分别就对应着这四句歌词的位置，这样很快就能得出输入的字符串：<code>CBDABCADBCCABBABBABACBCCABDADBABABB</code>。</p>
<h2 id="逆向观察"><a href="#逆向观察" class="headerlink" title="逆向观察"></a>逆向观察</h2><p>ELF文件，IDA查看：</p>
<p><img src="https://s2.ax1x.com/2019/07/19/ZvBvqO.png"></p>
<p>把<code>src</code>拷贝给<code>dest</code>,然后遍历<code>dict</code>里的字符串，如果有字符串同时与<code>dest</code>和输入的字符串相等则输入正确，很简单，只有一个小端问题，上一题有介绍。</p>
<h2 id="FLAG"><a href="#FLAG" class="headerlink" title="FLAG"></a>FLAG</h2><p>给的是一个网址，当时很懵逼，这TM不是逆向么…查看网页源码可以看见一段JS代码：</p>
<p><img src="https://s2.ax1x.com/2019/07/19/Zvy7m6.png"></p>
<p>如果输入的字符串满足这串超级长的判断则correct……<br>这串判断是由很多判断用&amp;&amp;连接起来的，分开之后按长度排序是这样的：</p>
<p><img src="https://s2.ax1x.com/2019/07/19/ZvctPg.png"></p>
<p>这就可以看出端倪了，按照这个顺序一个个判断的话每一次判断可以确定一个字符，上脚本吧：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">src=<span class="string">&#x27;超长判断&#x27;</span>.split(<span class="string">&#x27;&amp;&amp;&#x27;</span>)</span><br><span class="line">a=list(range(<span class="number">47</span>))</span><br><span class="line">src.sort(key=<span class="keyword">lambda</span> x:len(x))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">47</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">256</span>):</span><br><span class="line">        a[i]=j</span><br><span class="line">        <span class="keyword">if</span> eval(src[i]):</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">    print(chr(i),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="comment">#flag&#123;wh47_my5ter10us-do3s,the+phe45ant/c0nta1n&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="证明自己吧"><a href="#证明自己吧" class="headerlink" title="证明自己吧"></a>证明自己吧</h2><p>主函数是这样的：</p>
<p><img src="https://s2.ax1x.com/2019/07/19/Zv21N8.png"></p>
<p>输入<code>V4</code>,然后跟进判断函数：</p>
<p><img src="https://s2.ax1x.com/2019/07/19/Zv2y34.png"></p>
<p>输入的数据异或<code>0x20</code>，<code>v5</code>减<code>5</code>，之后比较，直接把<code>v5</code>的数据加<code>5</code>再异或<code>0x20</code>就可以了。</p>
<h1 id="BUUCTF"><a href="#BUUCTF" class="headerlink" title="BUUCTF"></a>BUUCTF</h1><h2 id="刮开有奖"><a href="#刮开有奖" class="headerlink" title="刮开有奖"></a>刮开有奖</h2><p>IDA查看主函数，跟进找到判断函数：</p>
<p><img src="https://s2.ax1x.com/2019/07/19/ZvWMY8.png"></p>
<p>输入长度为8的字符串给<code>String</code>之后进行判断:</p>
<p><img src="https://s2.ax1x.com/2019/07/19/ZvflAx.png"></p>
<p><img src="https://s2.ax1x.com/2019/07/19/ZvfD4f.png"></p>
<p>跟进<code>sub4010F0</code>分析得知是一个排序算法，将<code>v7</code>后连续10个数据进行排序，<code>sub401000</code>是base64编码，再根据后面的if判断，可以知道<code>String</code>第一位是排序后的<code>v7</code>，第二位是排序后的<code>v11</code>,后六位分别是<code>V1Ax</code>和<code>ak1w</code>的base64解码，拼在一起得到flag。</p>
<h1 id="CG-CTF"><a href="#CG-CTF" class="headerlink" title="CG-CTF"></a>CG-CTF</h1><h2 id="WxyVM1"><a href="#WxyVM1" class="headerlink" title="WxyVM1"></a>WxyVM1</h2><p>ELF文件，IDA查看：</p>
<p><img src="https://s2.ax1x.com/2019/07/19/ZvIiMF.png"></p>
<p>结构很简单，输入，，执行<code>sub4005B6</code>,判断长度，比较，要比较的字符串是给了的，只需要分析<code>sub4005B6</code>这个加密函数，跟进：</p>
<p><img src="https://s2.ax1x.com/2019/07/19/Zvo86U.png"></p>
<p>从<code>0x6010C0</code>开始取15000个数据来对输入进行加密，每三个一组，三个中第一个决定操作方式，第二个决定操作输入字符串中的第几位的字符，第三位决定进行操作的数据，IDC逆向脚本跑一下就能跑出输入的字符串</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> i;</span><br><span class="line"><span class="keyword">for</span> ( i = <span class="number">14997</span>; i &gt;= <span class="number">0</span>; i = i - <span class="number">3</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">auto</span> v0 = Byte(<span class="number">0x6010C0</span>+i);</span><br><span class="line">    <span class="keyword">auto</span> v3 = Byte(<span class="number">0x6010C0</span>+(i + <span class="number">2</span>));</span><br><span class="line">    <span class="keyword">auto</span> result = v0;</span><br><span class="line">    <span class="keyword">if</span>(v0==<span class="number">1</span>)&#123;</span><br><span class="line">        result =Byte(<span class="number">0x6010C0</span>+i + <span class="number">1</span>);</span><br><span class="line">        PatchByte(<span class="number">0x601060</span> + result*<span class="number">4</span>,Byte(<span class="number">0x601060</span> + result*<span class="number">4</span>)-v3);</span><br><span class="line">            &#125;</span><br><span class="line">     <span class="keyword">if</span>(v0==<span class="number">2</span>)&#123;</span><br><span class="line">         result =Byte(<span class="number">0x6010C0</span>+i + <span class="number">1</span>);</span><br><span class="line">       PatchByte(<span class="number">0x601060</span> + result*<span class="number">4</span>,Byte(<span class="number">0x601060</span> + result*<span class="number">4</span>)+v3);</span><br><span class="line">            &#125;</span><br><span class="line">    <span class="keyword">if</span>(v0==<span class="number">3</span>)&#123;</span><br><span class="line">        result =Byte(<span class="number">0x6010C0</span>+i + <span class="number">1</span>);</span><br><span class="line">        PatchByte(<span class="number">0x601060</span> + result*<span class="number">4</span>,Byte(<span class="number">0x601060</span> + result*<span class="number">4</span>)^v3);</span><br><span class="line">            &#125;</span><br><span class="line">   <span class="keyword">if</span>(v0==<span class="number">4</span>)&#123;</span><br><span class="line">        result =Byte(<span class="number">0x6010C0</span>+i + <span class="number">1</span>);</span><br><span class="line">        PatchByte(<span class="number">0x601060</span> + result*<span class="number">4</span>,Byte(<span class="number">0x601060</span> + result*<span class="number">4</span>)/v3);</span><br><span class="line">            &#125;</span><br><span class="line">   <span class="keyword">if</span>(v0==<span class="number">5</span>)&#123;</span><br><span class="line">         result =Byte(<span class="number">0x6010C0</span>+i + <span class="number">1</span>);</span><br><span class="line">    PatchByte(<span class="number">0x601060</span> + result*<span class="number">4</span>,Byte(<span class="number">0x601060</span> + result*<span class="number">4</span>)^Byte(<span class="number">0x601060</span>+v3*<span class="number">4</span>));</span><br><span class="line">            &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">24</span>;i++)</span><br><span class="line">&#123;</span><br><span class="line">Message(<span class="string">&quot;%c&quot;</span>,Byte(<span class="number">0x601060</span>+i*<span class="number">4</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//nctf&#123;Embr4ce_Vm_j0in_R3&#125;</span></span><br></pre></td></tr></table></figure>
<p>也可以dump下来用python脚本跑。</p>
<h2 id="maze"><a href="#maze" class="headerlink" title="maze"></a>maze</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">main</span><span class="params">(__int64 a1, <span class="keyword">char</span> **a2, <span class="keyword">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span> *v3; <span class="comment">// rsi</span></span><br><span class="line">  <span class="keyword">signed</span> __int64 v4; <span class="comment">// rbx</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> v5; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">char</span> v6; <span class="comment">// bp</span></span><br><span class="line">  <span class="keyword">char</span> v7; <span class="comment">// al</span></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span> *v8; <span class="comment">// rdi</span></span><br><span class="line">  __int64 v10; <span class="comment">// [rsp+0h] [rbp-28h]      //划重点，64位整型</span></span><br><span class="line"></span><br><span class="line">  v10 = <span class="number">0L</span>L;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Input flag:&quot;</span>);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, &amp;s1, <span class="number">0L</span>L);</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strlen</span>(&amp;s1) != <span class="number">24</span> || (v3 = <span class="string">&quot;nctf&#123;&quot;</span>, <span class="built_in">strncmp</span>(&amp;s1, <span class="string">&quot;nctf&#123;&quot;</span>, <span class="number">5u</span>LL)) || *(&amp;byte_6010BF + <span class="number">24</span>) != <span class="number">125</span> )  <span class="comment">//判断flag格式</span></span><br><span class="line">  &#123;</span><br><span class="line">LABEL_22:</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Wrong flag!&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  v4 = <span class="number">5L</span>L;                <span class="comment">//v4是遍历下标，从5开始，因为前5位是flag格式，上面已经判断过</span></span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strlen</span>(&amp;s1) - <span class="number">1</span> &gt; <span class="number">5</span> )    <span class="comment">//上面已经判断过长度，这里是干扰代码</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v5 = *(&amp;s1 + v4);</span><br><span class="line">      v6 = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">if</span> ( v5 &gt; <span class="number">78</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v5 = (<span class="keyword">unsigned</span> __int8)v5;</span><br><span class="line">        <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> __int8)v5 == <span class="number">79</span> )          <span class="comment">//若字符==&#x27;O&#x27;</span></span><br><span class="line">        &#123;</span><br><span class="line">          v7 = sub_400650((<span class="keyword">char</span> *)&amp;v10 + <span class="number">4</span>, v3);   <span class="comment">//v10低32位减1，并判断是否越界</span></span><br><span class="line">          <span class="keyword">goto</span> LABEL_14;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ( v5 == <span class="number">111</span> )                           <span class="comment">//若字符==&#x27;o&#x27;</span></span><br><span class="line">        &#123;</span><br><span class="line">          v7 = sub_400660((<span class="keyword">char</span> *)&amp;v10 + <span class="number">4</span>, v3);   <span class="comment">//v10低32位加1，并判断是否越界</span></span><br><span class="line">          <span class="keyword">goto</span> LABEL_14;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        v5 = (<span class="keyword">unsigned</span> __int8)v5;</span><br><span class="line">        <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> __int8)v5 == <span class="number">46</span> )            <span class="comment">//若字符==&#x27;.&#x27;</span></span><br><span class="line">        &#123;</span><br><span class="line">          v7 = sub_400670(&amp;v10, v3);               <span class="comment">//v10高32位减1，并判断是否越界</span></span><br><span class="line">          <span class="keyword">goto</span> LABEL_14;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ( v5 == <span class="number">48</span> )                            若字符==<span class="string">&#x27;0&#x27;</span></span><br><span class="line">        &#123;</span><br><span class="line">          v7 = sub_400680(&amp;v10, v3);                <span class="comment">//v10高32位加1，并判断是否越界</span></span><br><span class="line">LABEL_14:</span><br><span class="line">          v6 = v7;</span><br><span class="line">          <span class="keyword">goto</span> LABEL_15;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">LABEL_15:</span><br><span class="line">      v3 = (<span class="keyword">const</span> <span class="keyword">char</span> *)HIDWORD(v10);    </span><br><span class="line">      <span class="keyword">if</span> ( !(<span class="keyword">unsigned</span> __int8)sub_400690(asc_601060, HIDWORD(v10), (<span class="keyword">unsigned</span> <span class="keyword">int</span>)v10) )   <span class="comment">//用高32位和低32位表示行和列，判断在地图中是否撞墙</span></span><br><span class="line">        <span class="keyword">goto</span> LABEL_22;</span><br><span class="line">      <span class="keyword">if</span> ( ++v4 &gt;= <span class="built_in">strlen</span>(&amp;s1) - <span class="number">1</span> )   <span class="comment">//判断字符串读取结束</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( v6 )    <span class="comment">//判断是否撞墙</span></span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">LABEL_20:</span><br><span class="line">        v8 = <span class="string">&quot;Wrong flag!&quot;</span>;</span><br><span class="line">        <span class="keyword">goto</span> LABEL_21;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( asc_601060[<span class="number">8</span> * (<span class="keyword">signed</span> <span class="keyword">int</span>)v10 + SHIDWORD(v10)] != <span class="number">35</span> )  <span class="comment">//判断是否到达终点&quot;#&quot;</span></span><br><span class="line">    <span class="keyword">goto</span> LABEL_20;</span><br><span class="line">  v8 = <span class="string">&quot;Congratulations!&quot;</span>;</span><br><span class="line">LABEL_21:</span><br><span class="line">  <span class="built_in">puts</span>(v8);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0L</span>L;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>地图是在判断是否越界的函数中可以看出是8*8，判断是否撞墙的函数中可以找到地图数据，人脑遍历地图路线得到答案，地图和答案如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">  ******</span><br><span class="line">*   *  *</span><br><span class="line">*** * **</span><br><span class="line">**  * **</span><br><span class="line">*  *#  *</span><br><span class="line">** *** *</span><br><span class="line">**     *</span><br><span class="line">********</span><br><span class="line">o0oo00O000oooo..OO</span><br></pre></td></tr></table></figure>

<h1 id="杭电CTF"><a href="#杭电CTF" class="headerlink" title="杭电CTF"></a>杭电CTF</h1><h2 id="Beat-our-dice-game-and-get-the-flag"><a href="#Beat-our-dice-game-and-get-the-flag" class="headerlink" title="Beat our dice game and get the flag"></a>Beat our dice game and get the flag</h2><p>代码看起来比较畸形，用ollydbg动态调试看字符串可以大体猜出程序，一个扔骰子的游戏，要求多次按<code>enter</code>随机扔骰子，必须都扔到程序规定的数，甚至还要求扔到七：</p>
<p><img src="https://s2.ax1x.com/2019/07/19/ZxUtE9.png"></p>
<p>跟进找到每一个判断跳转，改掉没有扔到指定数的跳转，让程序一直运行下去到最后flag就会自己冒出来了：</p>
<p><img src="https://s2.ax1x.com/2019/07/19/ZxUf8P.png"></p>
<p><img src="https://s2.ax1x.com/2019/07/19/ZxwbUH.png"></p>
<p>这种没有输入的题，一般会比较简单，因为不用输入就表示flag就藏在文件中，只要能运行到某些命令就能拿到flag，不需要逆向算法什么的，这种应该只能叫破解，不能称为逆向才对。</p>
<h2 id="从文件中找flag"><a href="#从文件中找flag" class="headerlink" title="从文件中找flag"></a>从文件中找flag</h2><p>这个题好像实验吧也有，文件是一个叫keylead的文件，WinHex查看文件头发现是一个tar.xz的压缩包，Linux下解压后是一个ELF文件，IDA查看C语言伪代码，还是一个扔骰子…一样的方法，只是要在Linux环境下调试，用edb把关键跳转改掉，就可以得到flag</p>
<p><img src="https://s2.ax1x.com/2019/07/19/ZxBJYj.png"></p>
<p>flag我就不放了，懒得再去复盘截图，跟上一题一样的操作。</p>
<h1 id="Bugku"><a href="#Bugku" class="headerlink" title="Bugku"></a>Bugku</h1><h2 id="Mountain-climbing"><a href="#Mountain-climbing" class="headerlink" title="Mountain climbing"></a>Mountain climbing</h2><p>有一个UPX的壳，脱壳细节我在这里不细说，图简单的话吾爱破解有UPX脱壳工具，脱壳后先上IDA：</p>
<p><img src="https://s2.ax1x.com/2019/07/20/ZzIBee.png"></p>
<p>先用随机数生成一系列数据，然后根据输入的字符串在数据中找出一条从数据第一行到最后一行的路线使得路线上的值加起来最大，计算机是没有真正的随机数的，程序中给定了随机数种子，生成的随机数就是确定的，先照着程序自己写一个一样的随机数跑出数据：</p>
<p><img src="https://s2.ax1x.com/2019/07/20/ZzfA9f.png"></p>
<p>然后写脚本遍历所有路线求最大值吧：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> arr[<span class="number">20</span>][<span class="number">20</span>];</span><br><span class="line"><span class="keyword">int</span> sum = <span class="number">0</span>, maxx = <span class="number">0</span>, top;</span><br><span class="line"><span class="keyword">char</span> maxs[<span class="number">20</span>], s[<span class="number">20</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">fun</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	sum += arr[i][j];</span><br><span class="line">	<span class="keyword">if</span> (i == <span class="number">19</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (sum &gt; maxx)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">strcpy</span>(maxs, s);</span><br><span class="line">			maxx = sum;</span><br><span class="line">		&#125;</span><br><span class="line">		sum -= arr[i][j];</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		s[top++] = <span class="string">&#x27;L&#x27;</span>;</span><br><span class="line">		fun(i + <span class="number">1</span>, j);</span><br><span class="line">		top--;</span><br><span class="line">		s[top++] = <span class="string">&#x27;R&#x27;</span>;</span><br><span class="line">		fun(i + <span class="number">1</span>, j + <span class="number">1</span>);</span><br><span class="line">		top--;</span><br><span class="line">	&#125;</span><br><span class="line">	sum -= arr[i][j];</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	srand(<span class="number">0xc</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= i; j++)</span><br><span class="line">		&#123;</span><br><span class="line">			arr[i][j] = rand() % <span class="number">100000</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	fun(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; maxs &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//RRRRRLLRRRLRLRRRLRL</span></span><br></pre></td></tr></table></figure>
<p>交上去却是错的，回去慢慢看发现还有一个加密，是将输入的偶数位异或<code>0x4</code>，IDA看比较丑，可以在ollydbg里面观察输入数据的变化很明显就能看出来(此处我输入的是<code>&#39;0&#39;*19</code>)：</p>
<p><img src="https://s2.ax1x.com/2019/07/20/Zzol1P.png"></p>
<p>把之前得到的字符串再异或一下就可以得到flag了。</p>
<h2 id="Take-the-maze"><a href="#Take-the-maze" class="headerlink" title="Take the maze"></a>Take the maze</h2><p>迷宫，IDA查看：</p>
<p><img src="https://s2.ax1x.com/2019/07/26/euuia6.png"></p>
<p>先让输入key，然后有个isdebuggerpresent反调试，之后判断key长度，第17位异或1，之后有个奇怪的函数，之后判断必须全是十六进制字符，不然goto16就结束了，然后进入关键判断，跟进,代码如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BOOL __cdecl <span class="title">sub_463480</span><span class="params">(<span class="keyword">int</span> a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v1; <span class="comment">// ST18_4</span></span><br><span class="line">  <span class="keyword">int</span> v2; <span class="comment">// ST18_4</span></span><br><span class="line">  BOOL result; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> v4; <span class="comment">// ST18_4</span></span><br><span class="line">  <span class="keyword">int</span> v5; <span class="comment">// [esp+D8h] [ebp-38h]</span></span><br><span class="line">  <span class="keyword">int</span> v6; <span class="comment">// [esp+E4h] [ebp-2Ch]</span></span><br><span class="line">  <span class="keyword">int</span> v7; <span class="comment">// [esp+F0h] [ebp-20h]</span></span><br><span class="line">  <span class="keyword">int</span> v8; <span class="comment">// [esp+FCh] [ebp-14h]</span></span><br><span class="line">  <span class="keyword">int</span> v9; <span class="comment">// [esp+108h] [ebp-8h]</span></span><br><span class="line"></span><br><span class="line">  v9 = <span class="number">0</span>;</span><br><span class="line">  v6 = <span class="number">0</span>;</span><br><span class="line">  v5 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">2</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v1 = v9++;</span><br><span class="line">    <span class="keyword">if</span> ( v1 &gt;= <span class="number">12</span> )           <span class="comment">//24个字符，遍历12次，表示是两个字符一组</span></span><br><span class="line">      <span class="keyword">return</span> v5 == <span class="number">311</span>;       <span class="comment">//v5==311则返回真，flag正确</span></span><br><span class="line">    <span class="keyword">if</span> ( sub_45B1C7() )       <span class="comment">//又是一个IsDebuggerPresent</span></span><br><span class="line">      j__exit(<span class="number">0</span>);</span><br><span class="line">    v2 = *(<span class="keyword">char</span> *)(v6++ + a1);<span class="comment">//v2一组两个字符的前一个</span></span><br><span class="line">    <span class="keyword">switch</span> ( v2 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;0&#x27;</span>:</span><br><span class="line">        v8 = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">goto</span> LABEL_12;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">        v8 = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">goto</span> LABEL_12;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;2&#x27;</span>:</span><br><span class="line">        v8 = <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">goto</span> LABEL_12;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;3&#x27;</span>:</span><br><span class="line">        v8 = <span class="number">3</span>;</span><br><span class="line">        <span class="keyword">goto</span> LABEL_12;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;4&#x27;</span>:</span><br><span class="line">        v8 = <span class="number">4</span>;</span><br><span class="line">LABEL_12:</span><br><span class="line">        v4 = *(<span class="keyword">char</span> *)(v6++ + a1);<span class="comment">//v4表示后一个</span></span><br><span class="line">        <span class="keyword">switch</span> ( v4 )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">case</span> <span class="string">&#x27;5&#x27;</span>:</span><br><span class="line">            v7 = <span class="number">5</span>;</span><br><span class="line">            <span class="keyword">goto</span> LABEL_25;</span><br><span class="line">          <span class="keyword">case</span> <span class="string">&#x27;6&#x27;</span>:</span><br><span class="line">            v7 = <span class="number">6</span>;</span><br><span class="line">            <span class="keyword">goto</span> LABEL_25;</span><br><span class="line">          <span class="keyword">case</span> <span class="string">&#x27;7&#x27;</span>:</span><br><span class="line">            v7 = <span class="number">7</span>;</span><br><span class="line">            <span class="keyword">goto</span> LABEL_25;</span><br><span class="line">          <span class="keyword">case</span> <span class="string">&#x27;8&#x27;</span>:</span><br><span class="line">            v7 = <span class="number">8</span>;</span><br><span class="line">            <span class="keyword">goto</span> LABEL_25;</span><br><span class="line">          <span class="keyword">case</span> <span class="string">&#x27;9&#x27;</span>:</span><br><span class="line">            v7 = <span class="number">9</span>;</span><br><span class="line">            <span class="keyword">goto</span> LABEL_25;</span><br><span class="line">          <span class="keyword">case</span> <span class="string">&#x27;a&#x27;</span>:</span><br><span class="line">            v7 = <span class="number">10</span>;</span><br><span class="line">            <span class="keyword">goto</span> LABEL_25;</span><br><span class="line">          <span class="keyword">case</span> <span class="string">&#x27;b&#x27;</span>:</span><br><span class="line">            v7 = <span class="number">11</span>;</span><br><span class="line">            <span class="keyword">goto</span> LABEL_25;</span><br><span class="line">          <span class="keyword">case</span> <span class="string">&#x27;c&#x27;</span>:</span><br><span class="line">            v7 = <span class="number">12</span>;</span><br><span class="line">            <span class="keyword">goto</span> LABEL_25;</span><br><span class="line">          <span class="keyword">case</span> <span class="string">&#x27;d&#x27;</span>:</span><br><span class="line">            v7 = <span class="number">13</span>;</span><br><span class="line">            <span class="keyword">goto</span> LABEL_25;</span><br><span class="line">          <span class="keyword">case</span> <span class="string">&#x27;e&#x27;</span>:</span><br><span class="line">            v7 = <span class="number">14</span>;</span><br><span class="line">            <span class="keyword">goto</span> LABEL_25;</span><br><span class="line">          <span class="keyword">case</span> <span class="string">&#x27;f&#x27;</span>:</span><br><span class="line">            v7 = <span class="number">15</span>;</span><br><span class="line">LABEL_25:</span><br><span class="line">            <span class="keyword">switch</span> ( byte_541168[v8] ) <span class="comment">//byte_541168=&quot;delru0123456789&quot;</span></span><br><span class="line">            &#123;</span><br><span class="line">              <span class="keyword">case</span> <span class="string">&#x27;d&#x27;</span>:  <span class="comment">//down</span></span><br><span class="line">                sub_45CC4D((<span class="keyword">int</span>)&amp;v5, byte_541168[v7] - <span class="number">48</span>);<span class="comment">//向下走byte_541168[v7]-48步</span></span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">              <span class="keyword">case</span> <span class="string">&#x27;l&#x27;</span>:  /left</span><br><span class="line">                sub_45D0A3((<span class="keyword">int</span>)&amp;v5, byte_541168[v7] - <span class="number">48</span>);<span class="comment">//向左走</span></span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">              <span class="keyword">case</span> <span class="string">&#x27;r&#x27;</span>:  <span class="comment">//right</span></span><br><span class="line">                sub_45CB0D(&amp;v5, byte_541168[v7] - <span class="number">48</span>);<span class="comment">//向右走</span></span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">              <span class="keyword">case</span> <span class="string">&#x27;u&#x27;</span>:  <span class="comment">//up</span></span><br><span class="line">                sub_45D0E9(&amp;v5, byte_541168[v7] - <span class="number">48</span>);<span class="comment">//向上走</span></span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">              <span class="keyword">default</span>:</span><br><span class="line">                result = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">default</span>:</span><br><span class="line">            result = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        result = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上下左右的函数长得都很像，大概像这样：</p>
<p><img src="https://s2.ax1x.com/2019/07/26/euKI7q.png"></p>
<p>其他三个结构都是一样的，不再赘述，<code>result</code>的赋值都没有意义，因为函数并没有返回有用的值到上层，从这里走到下一行需要加26还有到第11行(下标为10)再继续走就会越界可知地图是11*26+25的规模，关键在于判断是否能够这样走的那个判断，IDC脚本把0到311的异或结果给跑出来看看：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> i;</span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">311</span>;i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(Byte(<span class="number">0x540548</span>+<span class="number">4</span>*i)^Byte(<span class="number">0x540068</span>+i*<span class="number">4</span>))</span><br><span class="line">Message(<span class="string">&quot;1 &quot;</span>);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">Message(<span class="string">&quot;0 &quot;</span>);</span><br><span class="line"><span class="keyword">if</span>((i+<span class="number">1</span>)%<span class="number">26</span>==<span class="number">0</span>)</span><br><span class="line">Message(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果如下：</p>
<p><img src="https://s2.ax1x.com/2019/07/26/euQNsH.png"></p>
<p>这是地图中每一个点能否往下走的dump结果，其他三个方向一样的方法，最后把四个方向的dump结果统一在一张地图上，脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">d=[<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,]</span><br><span class="line">l=[<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,]</span><br><span class="line">r=[<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,]</span><br><span class="line">u=[<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">311</span>):</span><br><span class="line">    <span class="keyword">if</span>(i%<span class="number">26</span>==<span class="number">0</span>):</span><br><span class="line">        print(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span>(d[i]):</span><br><span class="line">        print(<span class="string">&quot;d&quot;</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">&#x27; &#x27;</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span>(l[i]):</span><br><span class="line">        print(<span class="string">&quot;l&quot;</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">&quot; &quot;</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span>(r[i]):</span><br><span class="line">        print(<span class="string">&quot;r&quot;</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">&quot; &quot;</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span>(u[i]):</span><br><span class="line">        print(<span class="string">&quot;u&quot;</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">&quot; &quot;</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    print(<span class="string">&quot;|&quot;</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>地图如下：</p>
<p><img src="https://s2.ax1x.com/2019/07/27/eMXFAI.png"></p>
<p>其中u,d,l,r分别代表在此坐标往上，下，左，右可行，地图很简单就可以找到一条路：</p>
<p><img src="https://s2.ax1x.com/2019/07/28/eMjtit.png"></p>
<p>照着路线逆向出字符串<code>&quot;06360836063b0839173e0639&quot;</code>交上去不对，回头看之前那个奇怪的加密函数：</p>
<p><img src="https://s2.ax1x.com/2019/07/28/eMvAl8.png"></p>
<p>这个函数里面看起来很丑，不好分析，用ollydbg动态调试发现就是个遍历字符串每个字符异或下标<code>i</code>,此处我的输入样例为<code>&#39;0&#39;*24</code>   </p>
<p>第17位异或1：<br><img src="https://s2.ax1x.com/2019/07/28/eMvsXD.png"></p>
<p>异或下标：<br><img src="https://s2.ax1x.com/2019/07/28/eMv6ne.png"></p>
<p>脚本:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">a = list(<span class="string">&quot;06360836063b0839073e0639&quot;</span>)</span><br><span class="line">a[<span class="number">16</span>] = chr(ord(a[<span class="number">16</span>]) ^ <span class="number">1</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">24</span>):</span><br><span class="line">    print(chr(ord(a[i])^i), end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="comment">#07154=518?9i&lt;5=6!&amp;!v$#%.</span></span><br></pre></td></tr></table></figure>
<p>得到flag。</p>
<h2 id="file"><a href="#file" class="headerlink" title="file"></a>file</h2><p>IDA先看main函数：</p>
<p><img src="https://s2.ax1x.com/2019/07/28/e1Sxjx.png"></p>
<p>有个<code>flllag</code>像flag但是交上去不对，在这里只是一个字符串，用于判断，程序先读取文件内容(此处文件缺失)，然后与现有的数据进行异或比较判断文件正确与否，文件md5就是flag，<code>flllag</code>和<code>sttr_home</code>都能跟进找到，只需再分析<code>sub_400EB9</code>函数对<code>sttr_home</code>的加密,跟进：</p>
<p><img src="https://s2.ax1x.com/2019/07/28/e1prG9.png"></p>
<p>用同一个函数处理两个参数再加起来，再跟进这个函数:</p>
<p><img src="https://s2.ax1x.com/2019/07/28/e19pzn.png"></p>
<p>就是一个十六进制转数字的函数，上层函数中第一个参数的返回值乘16再加第二个参数的返回值，合在一起就是把两个十=十六进制字符转化成一个数字，至此就已分析完毕，上脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">str1=<span class="string">&#x27;664e06226625425d562e766e042d422c072c45692d125c7e6552606954646643&#x27;</span></span><br><span class="line">str2=<span class="string">&#x27;flag&#123;hello_player_come_on_hahah&#125;&#x27;</span></span><br><span class="line">str3=<span class="string">&#x27;&#x27;</span></span><br><span class="line">arr1=[]</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span>(<span class="params">c</span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="number">48</span>&lt;=ord(c)&lt;=<span class="number">57</span>:</span><br><span class="line">        <span class="keyword">return</span> ord(c)<span class="number">-48</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="number">65</span>&lt;=ord(c)&lt;=<span class="number">70</span>):</span><br><span class="line">        <span class="keyword">return</span> ord(c)<span class="number">-55</span></span><br><span class="line">    <span class="keyword">if</span>(ord(c)&lt;=<span class="number">96</span> <span class="keyword">or</span> ord(c)&gt;<span class="number">102</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0xffffffff</span></span><br><span class="line">    <span class="keyword">return</span> ord(c)<span class="number">-87</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">63</span>,<span class="number">2</span>):</span><br><span class="line">    arr1.append(<span class="number">16</span>*f(str1[i])+f(str1[i+<span class="number">1</span>]))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">32</span>):</span><br><span class="line">    str3+=chr(ord(str2[i])^arr1[i]^i)</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">&#x27;file.txt&#x27;</span>,<span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(str3)</span><br></pre></td></tr></table></figure>
<p>在线计算所创建文件的md5为<code>    914a7b9df69eab5b74b9edb7070e53e8</code>，加上flag{}就ok了。</p>
<h2 id="not-only-smc"><a href="#not-only-smc" class="headerlink" title="not only smc"></a>not only smc</h2><p>有个UPX的壳，shellcode里对upx进行了检测，脱壳后无法运行，就用ollydbg带壳调试，还有smc(自改变代码)，下<code>VirtualAlloc</code>断点，找smc解密，断点会断好几次，在程序结束前最后一次断下的时候<code>Ctrl+F9</code>运行到返回，找到到smc解密，是取输入字符串第九位开始后面的五位反复与给定字符串异或：</p>
<p><img src="https://s2.ax1x.com/2019/07/29/e1zncq.png"></p>
<p>因为自解密出来是一个函数，而VC下stdcall的函数头基本是固定的，像是这样：</p>
<p><img src="https://s2.ax1x.com/2019/07/29/e1zo5Q.png"></p>
<p>由此可以猜测五位解密字符，反复尝试后确定是<code>jUnk_</code>，之后步过解密出来的函数，输入的数据会发生变化，说明函数中对输入数据进行了加密，步入分析，有很多junk code(垃圾代码)，用来迷惑我们的，在输入的数据处下内存断点找到对数据进行加密的关键代码，是将输入的字符串与给定字符串一一异或：</p>
<p><img src="https://s2.ax1x.com/2019/07/29/e3knmR.png"></p>
<p>这个函数结束后继续步过，到后面又有一个函数再次改变了输入的数据，步入分析，还是有junk code，还是靠断点找到关键位置，分析得出这是一个三重嵌套循环异或，输入字符串的不同位之间异或是两层，外层还循环了65次</p>
<p>总的解密脚本如下:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">ans = [<span class="number">0xE8</span>, <span class="number">0x90</span>, <span class="number">0x24</span>, <span class="number">0xE6</span>, <span class="number">0x0A</span>, <span class="number">0xE3</span>, <span class="number">0xF7</span>, <span class="number">0xA8</span>, <span class="number">0x09</span>, <span class="number">0xC0</span>, <span class="number">0x35</span>, <span class="number">0x74</span>, <span class="number">0x26</span>, <span class="number">0x4D</span>, <span class="number">0xA0</span>, <span class="number">0x2D</span>,</span><br><span class="line">       <span class="number">0xD6</span>, <span class="number">0x1A</span>, <span class="number">0x5A</span>, <span class="number">0x5C</span>, <span class="number">0x16</span>, <span class="number">0x2D</span>, <span class="number">0xF0</span>, <span class="number">0x46</span>, <span class="number">0x44</span>, <span class="number">0x10</span>, <span class="number">0x5F</span>, <span class="number">0x83</span>, <span class="number">0x5B</span>, <span class="number">0xBE</span>, <span class="number">0x86</span>, <span class="number">0xAC</span>]</span><br><span class="line">key = [<span class="number">0xBB</span>, <span class="number">0x35</span>, <span class="number">0xAF</span>, <span class="number">0x29</span>, <span class="number">0xA3</span>, <span class="number">0x1D</span>, <span class="number">0x97</span>, <span class="number">0x11</span>, <span class="number">0x8B</span>, <span class="number">0x05</span>, <span class="number">0x7F</span>, <span class="number">0xF9</span>, <span class="number">0x73</span>, <span class="number">0xED</span>, <span class="number">0x67</span>, <span class="number">0xE1</span>,</span><br><span class="line">       <span class="number">0x5B</span>, <span class="number">0xD5</span>, <span class="number">0x4F</span>, <span class="number">0xC9</span>, <span class="number">0x43</span>, <span class="number">0xBD</span>, <span class="number">0x37</span>, <span class="number">0xB1</span>, <span class="number">0x2B</span>, <span class="number">0xA5</span>, <span class="number">0x1F</span>, <span class="number">0x99</span>, <span class="number">0x13</span>, <span class="number">0x8D</span>, <span class="number">0x07</span>, <span class="number">0x81</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">65</span>):</span><br><span class="line">    j = <span class="number">0x10</span></span><br><span class="line">    <span class="keyword">while</span> j &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> range(j):</span><br><span class="line">            ans[j+k] = ans[j+k] ^ ans[k]</span><br><span class="line">        j = j &gt;&gt; <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">32</span>):</span><br><span class="line">    ans[i]^=key[i]</span><br><span class="line">    print(chr(ans[i]),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="comment">#SMc_AnD_jUnk_C0de_1s_s0_fuunn~!</span></span><br></pre></td></tr></table></figure>

<h2 id="RE-Cirno"><a href="#RE-Cirno" class="headerlink" title="RE_Cirno"></a>RE_Cirno</h2><p>给了一张图片，下载下来WinHex打开发现有PK头，于是改后缀名为zip打开得到exe，IDA看main函数，很简单的程序，给定一个字符串，遍历字符串全部加9但是却没有保存，然后有个提示：</p>
<p><img src="https://s2.ax1x.com/2019/07/29/e3ONhn.png"></p>
<p>“9层栅栏”指栅栏密码，“反向”指逆序，先把字符串加9的结果算出来为<code>&quot;of&#125;e8lhz9n~r:9J&#123;t8p&#123;jg|&quot;</code>，这个东西栅栏解码后也不可能是flag，再看看汇编代码：</p>
<p><img src="https://s2.ax1x.com/2019/07/29/e3XtbD.png"></p>
<p>发现加9之后还异或了9，此处是IDA7.0伪代码处理的bug，换IDA6.8就会正常显示异或9，重新计算结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">arr1=[<span class="number">115</span>,<span class="number">94</span>,<span class="number">97</span>,<span class="number">114</span>,<span class="number">103</span>,<span class="number">47</span>,<span class="number">107</span>,<span class="number">114</span>,<span class="number">65</span>,<span class="number">48</span>,<span class="number">49</span>,<span class="number">105</span>,<span class="number">117</span>,<span class="number">118</span>,<span class="number">101</span>,<span class="number">48</span>,<span class="number">113</span>,<span class="number">95</span>,<span class="number">99</span>,<span class="number">47</span>,<span class="number">92</span>,<span class="number">116</span>,<span class="number">93</span>,<span class="number">102</span>]</span><br><span class="line">str1=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">24</span>):</span><br><span class="line">    str1+=chr((arr1[i]+<span class="number">9</span>)^<span class="number">9</span>)</span><br><span class="line">print(str1[::<span class="number">-1</span>])</span><br><span class="line"><span class="comment">#fotl1eas0gvw&#123;30Cr&#125;1yrcnu</span></span><br></pre></td></tr></table></figure>
<p>这个看起来就顺眼多了，有”flag”，有花括号，也有”Cirno”，接下来就是解栅栏密码，根据开头<code>&quot;flag&#123;&quot;</code>的格式还有提示的<code>&quot;9层&quot;</code>，确定应该是3*9的栅栏，但是字符串只有24位，应该要加3位，边做边猜最后确定字符串修改为<code>&quot;fotl1eas0gvw&#123;30Cr&#125;1y_rc_nu_&quot;</code>解码后得到<code>&quot;&quot;flag&#123;C1rno1sv3rycute0w0&#125;___</code>，将加上的下划线去掉得flag。</p>
<h2 id="babyLoginPlus"><a href="#babyLoginPlus" class="headerlink" title="babyLoginPlus"></a>babyLoginPlus</h2><p>有VM加密，IDA先看看，主函数长这样：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  sub_401510();</span><br><span class="line">  sub_4013C0((<span class="keyword">int</span>)&amp;unk_40B0B0);</span><br><span class="line">  <span class="keyword">return</span> (<span class="keyword">int</span>)sub_401540((<span class="keyword">char</span> *)&amp;unk_408240, dword_40823C, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>跟进第一个函数，里面对<code>byte_408034</code>进行赋值，长这样：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sub_401510</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v0; <span class="comment">// esi</span></span><br><span class="line">  <span class="keyword">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">char</span> *v2; <span class="comment">// ecx</span></span><br><span class="line">  <span class="keyword">char</span> v3; <span class="comment">// dl</span></span><br><span class="line"></span><br><span class="line">  v0 = dword_408030;</span><br><span class="line">  result = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( dword_408030 &gt; <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v2 = (<span class="keyword">char</span> *)&amp;unk_408160;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v3 = *v2;</span><br><span class="line">      v2 += <span class="number">2</span>;</span><br><span class="line">      byte_408034[result++] = (v3 ^ <span class="number">0x66</span>) - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( result &lt; v0 );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>值我们不用算，动态调试的时候可以看，之后第二个函数是申请内存之后进行4个拷贝，长这样：</p>
<p><img src="https://s2.ax1x.com/2019/07/29/e8A8Fx.png"></p>
<p>ollydbg里面看这四个拷贝的地方长这样(最上面16个字符是输入的字符串)：</p>
<p><img src="https://s2.ax1x.com/2019/07/29/e8A00A.png"></p>
<p>在输入的字符串处下内存访问断点，一步一步找能找到程序把输入的字符串一个一个的转移到另一个地方：</p>
<p><img src="https://s2.ax1x.com/2019/07/29/e8EYEn.png"></p>
<p>跟过去下内存断点就能找到转移后对字符串进行的一系列操作，最终解密脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">src = [<span class="number">0x32</span>, <span class="number">0x26</span>, <span class="number">0x18</span>, <span class="number">0x21</span>, <span class="number">0x41</span>, <span class="number">0x23</span>, <span class="number">0x2A</span>, <span class="number">0x57</span>, <span class="number">0x44</span>, <span class="number">0x29</span>, <span class="number">0x35</span>, <span class="number">0x12</span>, <span class="number">0x20</span>, <span class="number">0x17</span>, <span class="number">0x45</span>, <span class="number">0x1C</span>,</span><br><span class="line">       <span class="number">0x68</span>, <span class="number">0x2D</span>, <span class="number">0x7A</span>, <span class="number">0x79</span>, <span class="number">0x47</span>, <span class="number">0x7F</span>, <span class="number">0x44</span>, <span class="number">0x09</span>, <span class="number">0x1E</span>, <span class="number">0x75</span>, <span class="number">0x41</span>, <span class="number">0x2A</span>, <span class="number">0x19</span>, <span class="number">0x34</span>, <span class="number">0x76</span>, <span class="number">0x47</span>,</span><br><span class="line">       <span class="number">0x14</span>, <span class="number">0x50</span>, <span class="number">0x52</span>, <span class="number">0x76</span>, <span class="number">0x58</span>]</span><br><span class="line">key = [<span class="number">0x57</span>, <span class="number">0x65</span>, <span class="number">0x6C</span>, <span class="number">0x63</span>, <span class="number">0x6F</span>, <span class="number">0x6D</span>, <span class="number">0x65</span>, <span class="number">0x5F</span>, <span class="number">0x74</span>, <span class="number">0x6F</span>, <span class="number">0x5F</span>, <span class="number">0x73</span>, <span class="number">0x64</span>, <span class="number">0x6E</span>, <span class="number">0x69</span>, <span class="number">0x73</span>,</span><br><span class="line">       <span class="number">0x63</span>, <span class="number">0x5F</span>, <span class="number">0x32</span>, <span class="number">0x30</span>, <span class="number">0x31</span>, <span class="number">0x38</span>, <span class="number">0x5F</span>, <span class="number">0x42</span>, <span class="number">0x79</span>, <span class="number">0x2E</span>, <span class="number">0x5A</span>, <span class="number">0x65</span>, <span class="number">0x72</span>, <span class="number">0x6F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">       <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>]</span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(src)):</span><br><span class="line">    flag += chr(((src[i]<span class="number">-0x6</span>) ^ <span class="number">0x26</span> ^ key[i])+<span class="number">9</span>)</span><br><span class="line">print(flag)</span><br><span class="line"><span class="comment">#flag&#123;_p1us_babyL0gin_pPpPpPpPp_p1us_&#125;</span></span><br></pre></td></tr></table></figure>
            <!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls" data-autoplay="true">
                <source type="audio/mpeg" src="">
            </audio>
            
                <ul id="audio-list" style="display:none">
                    
                        
                            <li title='0' data-url='http://music.163.com/song/media/outer/url?id=420154189.mp3'></li>
                        
                    
                        
                            <li title='1' data-url='http://music.163.com/song/media/outer/url?id=527957820.mp3'></li>
                        
                    
                        
                            <li title='2' data-url='http://music.163.com/song/media/outer/url?id=1645064.mp3'></li>
                        
                    
                        
                            <li title='3' data-url='http://music.163.com/song/media/outer/url?id=39635710.mp3'></li>
                        
                    
                        
                            <li title='4' data-url='http://music.163.com/song/media/outer/url?id=464448450.mp3'></li>
                        
                    
                        
                            <li title='5' data-url='http://music.163.com/song/media/outer/url?id=33875750.mp3'></li>
                        
                    
                        
                            <li title='6' data-url='http://music.163.com/song/media/outer/url?id=864711417.mp3'></li>
                        
                    
                </ul>
            
        </div>
        
    <div id='gitalk-container' class="comment link"
		data-enable='true'
        data-ae='true'
        data-ci='b4b7681976b71e1c4b85'
        data-cs='1c0802349efe79789f01f3b548e96a4baf049907'
        data-r='HNightMan.github.io'
        data-o='HNightMan'
        data-a='HNightMan'
        data-d='false'
    >查看评论</div>


    </div>
    
        <div class='side'>
			<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E5%90%A7"><span class="toc-number">1.</span> <span class="toc-text">实验吧</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#whatamitoyou"><span class="toc-number">1.1.</span> <span class="toc-text">whatamitoyou</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%86%E5%90%91%E8%A7%82%E5%AF%9F"><span class="toc-number">1.2.</span> <span class="toc-text">逆向观察</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#FLAG"><span class="toc-number">1.3.</span> <span class="toc-text">FLAG</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%81%E6%98%8E%E8%87%AA%E5%B7%B1%E5%90%A7"><span class="toc-number">1.4.</span> <span class="toc-text">证明自己吧</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#BUUCTF"><span class="toc-number">2.</span> <span class="toc-text">BUUCTF</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%AE%E5%BC%80%E6%9C%89%E5%A5%96"><span class="toc-number">2.1.</span> <span class="toc-text">刮开有奖</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#CG-CTF"><span class="toc-number">3.</span> <span class="toc-text">CG-CTF</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#WxyVM1"><span class="toc-number">3.1.</span> <span class="toc-text">WxyVM1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#maze"><span class="toc-number">3.2.</span> <span class="toc-text">maze</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9D%AD%E7%94%B5CTF"><span class="toc-number">4.</span> <span class="toc-text">杭电CTF</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Beat-our-dice-game-and-get-the-flag"><span class="toc-number">4.1.</span> <span class="toc-text">Beat our dice game and get the flag</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%8E%E6%96%87%E4%BB%B6%E4%B8%AD%E6%89%BEflag"><span class="toc-number">4.2.</span> <span class="toc-text">从文件中找flag</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Bugku"><span class="toc-number">5.</span> <span class="toc-text">Bugku</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Mountain-climbing"><span class="toc-number">5.1.</span> <span class="toc-text">Mountain climbing</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Take-the-maze"><span class="toc-number">5.2.</span> <span class="toc-text">Take the maze</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#file"><span class="toc-number">5.3.</span> <span class="toc-text">file</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#not-only-smc"><span class="toc-number">5.4.</span> <span class="toc-text">not only smc</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RE-Cirno"><span class="toc-number">5.5.</span> <span class="toc-text">RE_Cirno</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#babyLoginPlus"><span class="toc-number">5.6.</span> <span class="toc-text">babyLoginPlus</span></a></li></ol></li></ol>	
        </div>
    
</div>


    </div>
</div>
</body>

<script src="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>


<script src="//lib.baomitu.com/jquery/1.8.3/jquery.min.js"></script>
<script src="/js/plugin.js"></script>
<script src="/js/typed.js"></script>
<script src="/js/diaspora.js"></script>


<link rel="stylesheet" href="/photoswipe/photoswipe.css">
<link rel="stylesheet" href="/photoswipe/default-skin/default-skin.css">


<script src="/photoswipe/photoswipe.min.js"></script>
<script src="/photoswipe/photoswipe-ui-default.min.js"></script>


<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>






</html>
